
services:
  frontend-dev:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev.frontend
    container_name: frontend-dev
    environment:
      - CHOKIDAR_USEPOLLING=true     # ðŸ‘ˆ enables file watching inside Docker
      - WATCHPACK_POLLING=true
    env_file:
      - .env.development
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    depends_on:
      - backend-dev
    networks:
      - imaginarium

  backend-dev:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev.backend
    container_name: backend-dev
    env_file:
      - .env.development
    environment:
      - OLLAMA_HOST=http://ollama-dev:11434
    volumes:
      - ./backend/app:/app/app  # live-reload backend code
    # Help Windows/WSL2 environments resolve external hosts reliably.
    # Remove if your Docker Desktop is already set with custom DNS.
    dns:
      - 1.1.1.1
      - 8.8.8.8
    ports:
      - "8001:8000"
    networks:
      - imaginarium

  nginx-dev:
    image: nginx:1.27
    container_name: nginx-dev
    volumes:
      - ./nginx.dev.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - "3002:80"
    depends_on:
      - frontend-dev
      - backend-dev
    networks:
      - imaginarium

  ollama-dev:
    image: ollama/ollama:latest
    container_name: ollama-dev
    ports:
      - "11434:11434"
    networks:
      - imaginarium

networks:
  imaginarium:
    driver: bridge
