{"ast":null,"code":"import React,{useState}from\"react\";import{useAuth0}from\"@auth0/auth0-react\";import\"../styles/page-rag.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Rag(){const{getAccessTokenSilently}=useAuth0();const[file,setFile]=useState(null);const[uploaded,setUploaded]=useState(false);const[question,setQuestion]=useState(\"\");const[answer,setAnswer]=useState(\"\");const[busy,setBusy]=useState(false);const upload=async()=>{if(!file)return;setBusy(true);const token=await getAccessTokenSilently();const form=new FormData();form.append(\"file\",file);const res=await fetch(\"/api/rag/upload\",{method:\"POST\",headers:{Authorization:\"Bearer \".concat(token)},body:form});if(res.ok)setUploaded(true);setBusy(false);};const ask=async()=>{if(!question)return;setAnswer(\"\");setBusy(true);const token=await getAccessTokenSilently();const res=await fetch(\"/api/rag/ask\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)},body:JSON.stringify({question})});// Stream response progressively\nconst reader=res.body.getReader();const dec=new TextDecoder();let partial=\"\";while(true){const{done,value}=await reader.read();if(done)break;const lines=dec.decode(value).trim().split(\"\\n\");for(let line of lines){try{const j=JSON.parse(line);if(j.response){partial+=j.response;setAnswer(partial);}}catch(_unused){continue;}}}setBusy(false);};return/*#__PURE__*/_jsxs(\"div\",{className:\"page rag\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Chat with Document (RAG)\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".txt,.pdf,.doc,.docx,.csv,.xls,.xlsx\",onChange:e=>setFile(e.target.files[0])}),/*#__PURE__*/_jsx(\"button\",{onClick:upload,disabled:!file||busy,children:busy?\"Uploading…\":\"Upload Document\"}),uploaded&&/*#__PURE__*/_jsx(\"span\",{className:\"ok\",children:\"\\u2705 Uploaded\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"note\",children:\"Supports TXT, PDF, DOC/DOCX, CSV, Excel (less than or equat to 20MB). Model can answer math from uploaded tables.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"input\",{value:question,onChange:e=>setQuestion(e.target.value),placeholder:\"Ask about your document...\"}),/*#__PURE__*/_jsx(\"button\",{onClick:ask,disabled:!uploaded||busy,children:busy?\"Thinking…\":\"Ask\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"answer-stream\",children:/*#__PURE__*/_jsx(\"pre\",{children:answer})})]});}","map":{"version":3,"names":["React","useState","useAuth0","jsx","_jsx","jsxs","_jsxs","Rag","getAccessTokenSilently","file","setFile","uploaded","setUploaded","question","setQuestion","answer","setAnswer","busy","setBusy","upload","token","form","FormData","append","res","fetch","method","headers","Authorization","concat","body","ok","ask","JSON","stringify","reader","getReader","dec","TextDecoder","partial","done","value","read","lines","decode","trim","split","line","j","parse","response","_unused","className","children","type","accept","onChange","e","target","files","onClick","disabled","placeholder"],"sources":["/home/python/imaginarium-ai/frontend/src/pages/Rag.js"],"sourcesContent":["import React, { useState } from \"react\";\nimport { useAuth0 } from \"@auth0/auth0-react\";\nimport \"../styles/page-rag.css\";\n\n\nexport default function Rag(){\nconst { getAccessTokenSilently } = useAuth0();\nconst [file, setFile] = useState(null);\nconst [uploaded, setUploaded] = useState(false);\nconst [question, setQuestion] = useState(\"\");\nconst [answer, setAnswer] = useState(\"\");\nconst [busy, setBusy] = useState(false);\n\n\nconst upload = async () => {\nif(!file) return;\nsetBusy(true);\nconst token = await getAccessTokenSilently();\nconst form = new FormData(); form.append(\"file\", file);\nconst res = await fetch(`/api/rag/upload`, { method: \"POST\", headers: { Authorization: `Bearer ${token}` }, body: form });\nif(res.ok) setUploaded(true);\nsetBusy(false);\n};\n\n\nconst ask = async () => {\nif(!question) return;\nsetAnswer(\"\"); setBusy(true);\nconst token = await getAccessTokenSilently();\nconst res = await fetch(`/api/rag/ask`, {\nmethod: \"POST\",\nheaders: { \"Content-Type\": \"application/json\", Authorization: `Bearer ${token}` },\nbody: JSON.stringify({ question })\n});\n\n\n// Stream response progressively\nconst reader = res.body.getReader();\nconst dec = new TextDecoder();\nlet partial = \"\";\nwhile (true) {\nconst { done, value } = await reader.read();\nif (done) break;\nconst lines = dec.decode(value).trim().split(\"\\n\");\nfor (let line of lines) {\ntry {\nconst j = JSON.parse(line);\nif (j.response) {\npartial += j.response;\nsetAnswer(partial);\n}\n} catch { continue; }\n}\n}\nsetBusy(false);\n};\n\n\nreturn (\n<div className=\"page rag\">\n<h2>Chat with Document (RAG)</h2>\n<div className=\"card\">\n<input type=\"file\" accept=\".txt,.pdf,.doc,.docx,.csv,.xls,.xlsx\" onChange={e=>setFile(e.target.files[0])} />\n<button onClick={upload} disabled={!file || busy}>{busy?\"Uploading…\":\"Upload Document\"}</button>\n{uploaded && <span className=\"ok\">✅ Uploaded</span>}\n</div>\n<p className=\"note\">Supports TXT, PDF, DOC/DOCX, CSV, Excel (less than or equat to 20MB). Model can answer math from uploaded tables.</p>\n<div className=\"card\">\n<input value={question} onChange={e=>setQuestion(e.target.value)} placeholder=\"Ask about your document...\" />\n<button onClick={ask} disabled={!uploaded || busy}>{busy?\"Thinking…\":\"Ask\"}</button>\n</div>\n<div className=\"answer-stream\">\n<pre>{answer}</pre>\n</div>\n</div>\n);\n}\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,KAAQ,OAAO,CACvC,OAASC,QAAQ,KAAQ,oBAAoB,CAC7C,MAAO,wBAAwB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAGhC,cAAe,SAAS,CAAAC,GAAGA,CAAA,CAAE,CAC7B,KAAM,CAAEC,sBAAuB,CAAC,CAAGN,QAAQ,CAAC,CAAC,CAC7C,KAAM,CAACO,IAAI,CAAEC,OAAO,CAAC,CAAGT,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACU,QAAQ,CAAEC,WAAW,CAAC,CAAGX,QAAQ,CAAC,KAAK,CAAC,CAC/C,KAAM,CAACY,QAAQ,CAAEC,WAAW,CAAC,CAAGb,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACc,MAAM,CAAEC,SAAS,CAAC,CAAGf,QAAQ,CAAC,EAAE,CAAC,CACxC,KAAM,CAACgB,IAAI,CAAEC,OAAO,CAAC,CAAGjB,QAAQ,CAAC,KAAK,CAAC,CAGvC,KAAM,CAAAkB,MAAM,CAAG,KAAAA,CAAA,GAAY,CAC3B,GAAG,CAACV,IAAI,CAAE,OACVS,OAAO,CAAC,IAAI,CAAC,CACb,KAAM,CAAAE,KAAK,CAAG,KAAM,CAAAZ,sBAAsB,CAAC,CAAC,CAC5C,KAAM,CAAAa,IAAI,CAAG,GAAI,CAAAC,QAAQ,CAAC,CAAC,CAAED,IAAI,CAACE,MAAM,CAAC,MAAM,CAAEd,IAAI,CAAC,CACtD,KAAM,CAAAe,GAAG,CAAG,KAAM,CAAAC,KAAK,mBAAoB,CAAEC,MAAM,CAAE,MAAM,CAAEC,OAAO,CAAE,CAAEC,aAAa,WAAAC,MAAA,CAAYT,KAAK,CAAG,CAAC,CAAEU,IAAI,CAAET,IAAK,CAAC,CAAC,CACzH,GAAGG,GAAG,CAACO,EAAE,CAAEnB,WAAW,CAAC,IAAI,CAAC,CAC5BM,OAAO,CAAC,KAAK,CAAC,CACd,CAAC,CAGD,KAAM,CAAAc,GAAG,CAAG,KAAAA,CAAA,GAAY,CACxB,GAAG,CAACnB,QAAQ,CAAE,OACdG,SAAS,CAAC,EAAE,CAAC,CAAEE,OAAO,CAAC,IAAI,CAAC,CAC5B,KAAM,CAAAE,KAAK,CAAG,KAAM,CAAAZ,sBAAsB,CAAC,CAAC,CAC5C,KAAM,CAAAgB,GAAG,CAAG,KAAM,CAAAC,KAAK,gBAAiB,CACxCC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAkB,CAAEC,aAAa,WAAAC,MAAA,CAAYT,KAAK,CAAG,CAAC,CACjFU,IAAI,CAAEG,IAAI,CAACC,SAAS,CAAC,CAAErB,QAAS,CAAC,CACjC,CAAC,CAAC,CAGF;AACA,KAAM,CAAAsB,MAAM,CAAGX,GAAG,CAACM,IAAI,CAACM,SAAS,CAAC,CAAC,CACnC,KAAM,CAAAC,GAAG,CAAG,GAAI,CAAAC,WAAW,CAAC,CAAC,CAC7B,GAAI,CAAAC,OAAO,CAAG,EAAE,CAChB,MAAO,IAAI,CAAE,CACb,KAAM,CAAEC,IAAI,CAAEC,KAAM,CAAC,CAAG,KAAM,CAAAN,MAAM,CAACO,IAAI,CAAC,CAAC,CAC3C,GAAIF,IAAI,CAAE,MACV,KAAM,CAAAG,KAAK,CAAGN,GAAG,CAACO,MAAM,CAACH,KAAK,CAAC,CAACI,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,IAAI,CAAC,CAClD,IAAK,GAAI,CAAAC,IAAI,GAAI,CAAAJ,KAAK,CAAE,CACxB,GAAI,CACJ,KAAM,CAAAK,CAAC,CAAGf,IAAI,CAACgB,KAAK,CAACF,IAAI,CAAC,CAC1B,GAAIC,CAAC,CAACE,QAAQ,CAAE,CAChBX,OAAO,EAAIS,CAAC,CAACE,QAAQ,CACrBlC,SAAS,CAACuB,OAAO,CAAC,CAClB,CACA,CAAE,MAAAY,OAAA,CAAM,CAAE,SAAU,CACpB,CACA,CACAjC,OAAO,CAAC,KAAK,CAAC,CACd,CAAC,CAGD,mBACAZ,KAAA,QAAK8C,SAAS,CAAC,UAAU,CAAAC,QAAA,eACzBjD,IAAA,OAAAiD,QAAA,CAAI,0BAAwB,CAAI,CAAC,cACjC/C,KAAA,QAAK8C,SAAS,CAAC,MAAM,CAAAC,QAAA,eACrBjD,IAAA,UAAOkD,IAAI,CAAC,MAAM,CAACC,MAAM,CAAC,sCAAsC,CAACC,QAAQ,CAAEC,CAAC,EAAE/C,OAAO,CAAC+C,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC,CAAE,CAAE,CAAC,cAC5GvD,IAAA,WAAQwD,OAAO,CAAEzC,MAAO,CAAC0C,QAAQ,CAAE,CAACpD,IAAI,EAAIQ,IAAK,CAAAoC,QAAA,CAAEpC,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAS,CAAC,CAC/FN,QAAQ,eAAIP,IAAA,SAAMgD,SAAS,CAAC,IAAI,CAAAC,QAAA,CAAC,iBAAU,CAAM,CAAC,EAC9C,CAAC,cACNjD,IAAA,MAAGgD,SAAS,CAAC,MAAM,CAAAC,QAAA,CAAC,mHAAiH,CAAG,CAAC,cACzI/C,KAAA,QAAK8C,SAAS,CAAC,MAAM,CAAAC,QAAA,eACrBjD,IAAA,UAAOqC,KAAK,CAAE5B,QAAS,CAAC2C,QAAQ,CAAEC,CAAC,EAAE3C,WAAW,CAAC2C,CAAC,CAACC,MAAM,CAACjB,KAAK,CAAE,CAACqB,WAAW,CAAC,4BAA4B,CAAE,CAAC,cAC7G1D,IAAA,WAAQwD,OAAO,CAAE5B,GAAI,CAAC6B,QAAQ,CAAE,CAAClD,QAAQ,EAAIM,IAAK,CAAAoC,QAAA,CAAEpC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAS,CAAC,EAC/E,CAAC,cACNb,IAAA,QAAKgD,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC9BjD,IAAA,QAAAiD,QAAA,CAAMtC,MAAM,CAAM,CAAC,CACd,CAAC,EACD,CAAC,CAEN","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}