{"ast":null,"code":"import axios from\"axios\";import{useAuth0}from\"@auth0/auth0-react\";export function useApi(){const{getAccessTokenSilently,loginWithRedirect}=useAuth0();const audience=process.env.REACT_APP_AUTH0_AUDIENCE;const api=axios.create({baseURL:\"/api\"});// ✅ consistent for all routes\napi.interceptors.request.use(async config=>{try{const token=await getAccessTokenSilently({authorizationParams:{audience,scope:\"openid profile email\"}});config.headers.Authorization=\"Bearer \".concat(token);}catch(e){const needConsent=(e===null||e===void 0?void 0:e.error)===\"consent_required\"||(e===null||e===void 0?void 0:e.error)===\"login_required\"||String((e===null||e===void 0?void 0:e.message)||\"\").toLowerCase().includes(\"consent required\");if(needConsent){await loginWithRedirect({authorizationParams:{prompt:\"consent\",audience,scope:\"openid profile email\"}});}}return config;});api.interceptors.response.use(r=>r,async err=>{var _err$response;if((err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401){await loginWithRedirect({authorizationParams:{prompt:\"login\",audience,scope:\"openid profile email\"}});}throw err;});return api;}","map":{"version":3,"names":["axios","useAuth0","useApi","getAccessTokenSilently","loginWithRedirect","audience","process","env","REACT_APP_AUTH0_AUDIENCE","api","create","baseURL","interceptors","request","use","config","token","authorizationParams","scope","headers","Authorization","concat","e","needConsent","error","String","message","toLowerCase","includes","prompt","response","r","err","_err$response","status"],"sources":["/home/python/imaginarium-ai/frontend/src/services/api.js"],"sourcesContent":["import axios from \"axios\";\nimport { useAuth0 } from \"@auth0/auth0-react\";\n\nexport function useApi() {\n  const { getAccessTokenSilently, loginWithRedirect } = useAuth0();\n  const audience = process.env.REACT_APP_AUTH0_AUDIENCE;\n\n  const api = axios.create({ baseURL: \"/api\" }); // ✅ consistent for all routes\n\n  api.interceptors.request.use(async (config) => {\n    try {\n      const token = await getAccessTokenSilently({\n        authorizationParams: { audience, scope: \"openid profile email\" },\n      });\n      config.headers.Authorization = `Bearer ${token}`;\n    } catch (e) {\n      const needConsent =\n        e?.error === \"consent_required\" ||\n        e?.error === \"login_required\" ||\n        String(e?.message || \"\").toLowerCase().includes(\"consent required\");\n      if (needConsent) {\n        await loginWithRedirect({\n          authorizationParams: {\n            prompt: \"consent\",\n            audience,\n            scope: \"openid profile email\",\n          },\n        });\n      }\n    }\n    return config;\n  });\n\n  api.interceptors.response.use(\n    (r) => r,\n    async (err) => {\n      if (err?.response?.status === 401) {\n        await loginWithRedirect({\n          authorizationParams: {\n            prompt: \"login\",\n            audience,\n            scope: \"openid profile email\",\n          },\n        });\n      }\n      throw err;\n    }\n  );\n\n  return api;\n}\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAASC,QAAQ,KAAQ,oBAAoB,CAE7C,MAAO,SAAS,CAAAC,MAAMA,CAAA,CAAG,CACvB,KAAM,CAAEC,sBAAsB,CAAEC,iBAAkB,CAAC,CAAGH,QAAQ,CAAC,CAAC,CAChE,KAAM,CAAAI,QAAQ,CAAGC,OAAO,CAACC,GAAG,CAACC,wBAAwB,CAErD,KAAM,CAAAC,GAAG,CAAGT,KAAK,CAACU,MAAM,CAAC,CAAEC,OAAO,CAAE,MAAO,CAAC,CAAC,CAAE;AAE/CF,GAAG,CAACG,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,KAAO,CAAAC,MAAM,EAAK,CAC7C,GAAI,CACF,KAAM,CAAAC,KAAK,CAAG,KAAM,CAAAb,sBAAsB,CAAC,CACzCc,mBAAmB,CAAE,CAAEZ,QAAQ,CAAEa,KAAK,CAAE,sBAAuB,CACjE,CAAC,CAAC,CACFH,MAAM,CAACI,OAAO,CAACC,aAAa,WAAAC,MAAA,CAAaL,KAAK,CAAE,CAClD,CAAE,MAAOM,CAAC,CAAE,CACV,KAAM,CAAAC,WAAW,CACf,CAAAD,CAAC,SAADA,CAAC,iBAADA,CAAC,CAAEE,KAAK,IAAK,kBAAkB,EAC/B,CAAAF,CAAC,SAADA,CAAC,iBAADA,CAAC,CAAEE,KAAK,IAAK,gBAAgB,EAC7BC,MAAM,CAAC,CAAAH,CAAC,SAADA,CAAC,iBAADA,CAAC,CAAEI,OAAO,GAAI,EAAE,CAAC,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,kBAAkB,CAAC,CACrE,GAAIL,WAAW,CAAE,CACf,KAAM,CAAAnB,iBAAiB,CAAC,CACtBa,mBAAmB,CAAE,CACnBY,MAAM,CAAE,SAAS,CACjBxB,QAAQ,CACRa,KAAK,CAAE,sBACT,CACF,CAAC,CAAC,CACJ,CACF,CACA,MAAO,CAAAH,MAAM,CACf,CAAC,CAAC,CAEFN,GAAG,CAACG,YAAY,CAACkB,QAAQ,CAAChB,GAAG,CAC1BiB,CAAC,EAAKA,CAAC,CACR,KAAO,CAAAC,GAAG,EAAK,KAAAC,aAAA,CACb,GAAI,CAAAD,GAAG,SAAHA,GAAG,kBAAAC,aAAA,CAAHD,GAAG,CAAEF,QAAQ,UAAAG,aAAA,iBAAbA,aAAA,CAAeC,MAAM,IAAK,GAAG,CAAE,CACjC,KAAM,CAAA9B,iBAAiB,CAAC,CACtBa,mBAAmB,CAAE,CACnBY,MAAM,CAAE,OAAO,CACfxB,QAAQ,CACRa,KAAK,CAAE,sBACT,CACF,CAAC,CAAC,CACJ,CACA,KAAM,CAAAc,GAAG,CACX,CACF,CAAC,CAED,MAAO,CAAAvB,GAAG,CACZ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}