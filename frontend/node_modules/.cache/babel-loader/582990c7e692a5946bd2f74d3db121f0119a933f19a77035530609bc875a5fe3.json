{"ast":null,"code":"import React,{useRef,useState}from\"react\";import{useApi}from\"../services/api\";import{Prism as SyntaxHighlighter}from\"react-syntax-highlighter\";import{oneDark}from\"react-syntax-highlighter/dist/esm/styles/prism\";import\"../styles/page-codefix.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LANGUAGE_MAP={js:\"javascript\",jsx:\"javascript\",ts:\"typescript\",tsx:\"tsx\",py:\"python\",rb:\"ruby\",java:\"java\",go:\"go\",rs:\"rust\",cpp:\"cpp\",c:\"c\",cs:\"csharp\",php:\"php\",swift:\"swift\",kt:\"kotlin\"};function guessLanguage(){let filename=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";const ext=filename.split(\".\").pop();return LANGUAGE_MAP[ext]||\"text\";}export default function CodeFix(){const api=useApi();const fileInputRef=useRef(null);const[selectedFile,setSelectedFile]=useState(null);const[summary,setSummary]=useState(\"\");const[fixedCode,setFixedCode]=useState(\"\");const[loading,setLoading]=useState(false);const[error,setError]=useState(\"\");const triggerUpload=()=>{var _fileInputRef$current;(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();};const handleFileChange=async event=>{var _event$target$files;const file=(_event$target$files=event.target.files)===null||_event$target$files===void 0?void 0:_event$target$files[0];if(!file)return;setSelectedFile(file);setError(\"\");setSummary(\"\");setFixedCode(\"\");await processFile(file);};const processFile=async file=>{setLoading(true);try{const data=new FormData();data.append(\"file\",file);const response=await api.post(\"/codefix\",data,{headers:{\"Content-Type\":\"multipart/form-data\"}});setSummary(response.data.summary);setFixedCode(response.data.fixed_code);}catch(err){var _err$response,_err$response$data;console.error(err);setError((err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||\"Unable to process file.\");}finally{setLoading(false);}};const copyFixed=async()=>{if(!fixedCode)return;await navigator.clipboard.writeText(fixedCode);};const downloadFixed=()=>{if(!fixedCode||!selectedFile)return;const blob=new Blob([fixedCode],{type:\"text/plain\"});const url=URL.createObjectURL(blob);const a=document.createElement(\"a\");a.href=url;const parts=selectedFile.name.split(\".\");const ext=parts.length>1?parts.pop():\"txt\";a.download=\"\".concat(parts.join(\".\")||\"codefix-output\",\".fixed.\").concat(ext);a.click();URL.revokeObjectURL(url);};const language=guessLanguage(selectedFile===null||selectedFile===void 0?void 0:selectedFile.name);return/*#__PURE__*/_jsxs(\"div\",{className:\"page codefix-page\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"codefix-pane codefix-left\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"codefix-card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Code Fix Agent\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Upload a file to let the default agent clean it up and summarize the edits.\"}),/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",accept:\".js,.jsx,.ts,.tsx,.py,.rb,.java,.go,.rs,.cpp,.c,.cs,.php,.swift,.kt,.json,.txt\",style:{display:\"none\"},onChange:handleFileChange}),/*#__PURE__*/_jsx(\"button\",{className:\"upload-btn\",onClick:triggerUpload,disabled:loading,children:selectedFile?\"Re-upload\":\"Upload\"}),selectedFile&&/*#__PURE__*/_jsxs(\"p\",{className:\"file-meta\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"File:\"}),\" \",selectedFile.name]}),loading&&/*#__PURE__*/_jsx(\"p\",{className:\"status\",children:\"Running agent...\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"status error\",children:error}),summary&&/*#__PURE__*/_jsxs(\"div\",{className:\"summary-box\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Agent Summary\"}),/*#__PURE__*/_jsx(\"p\",{children:summary})]}),fixedCode&&/*#__PURE__*/_jsxs(\"div\",{className:\"codefix-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:copyFixed,children:\"Copy Code\"}),/*#__PURE__*/_jsx(\"button\",{onClick:downloadFixed,children:\"Download\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"codefix-pane codefix-right\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"code-view\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"code-view__header\",children:/*#__PURE__*/_jsx(\"span\",{children:selectedFile?selectedFile.name:\"Awaiting upload...\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"code-view__body\",children:/*#__PURE__*/_jsx(SyntaxHighlighter,{language:language,style:oneDark,showLineNumbers:true,wrapLines:true,customStyle:{background:\"transparent\",minHeight:\"100%\"},children:fixedCode||\"// Upload a file to see the fixed output here.\"})})]})})]});}","map":{"version":3,"names":["React","useRef","useState","useApi","Prism","SyntaxHighlighter","oneDark","jsx","_jsx","jsxs","_jsxs","LANGUAGE_MAP","js","ts","tsx","py","rb","java","go","rs","cpp","c","cs","php","swift","kt","guessLanguage","filename","arguments","length","undefined","ext","split","pop","CodeFix","api","fileInputRef","selectedFile","setSelectedFile","summary","setSummary","fixedCode","setFixedCode","loading","setLoading","error","setError","triggerUpload","_fileInputRef$current","current","click","handleFileChange","event","_event$target$files","file","target","files","processFile","data","FormData","append","response","post","headers","fixed_code","err","_err$response","_err$response$data","console","detail","copyFixed","navigator","clipboard","writeText","downloadFixed","blob","Blob","type","url","URL","createObjectURL","a","document","createElement","href","parts","name","download","concat","join","revokeObjectURL","language","className","children","ref","accept","style","display","onChange","onClick","disabled","showLineNumbers","wrapLines","customStyle","background","minHeight"],"sources":["/home/python/imaginarium-ai/frontend/src/pages/CodeFix.js"],"sourcesContent":["import React, { useRef, useState } from \"react\";\nimport { useApi } from \"../services/api\";\nimport { Prism as SyntaxHighlighter } from \"react-syntax-highlighter\";\nimport { oneDark } from \"react-syntax-highlighter/dist/esm/styles/prism\";\nimport \"../styles/page-codefix.css\";\n\nconst LANGUAGE_MAP = {\n  js: \"javascript\",\n  jsx: \"javascript\",\n  ts: \"typescript\",\n  tsx: \"tsx\",\n  py: \"python\",\n  rb: \"ruby\",\n  java: \"java\",\n  go: \"go\",\n  rs: \"rust\",\n  cpp: \"cpp\",\n  c: \"c\",\n  cs: \"csharp\",\n  php: \"php\",\n  swift: \"swift\",\n  kt: \"kotlin\",\n};\n\nfunction guessLanguage(filename = \"\") {\n  const ext = filename.split(\".\").pop();\n  return LANGUAGE_MAP[ext] || \"text\";\n}\n\nexport default function CodeFix() {\n  const api = useApi();\n  const fileInputRef = useRef(null);\n  const [selectedFile, setSelectedFile] = useState(null);\n  const [summary, setSummary] = useState(\"\");\n  const [fixedCode, setFixedCode] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  const triggerUpload = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileChange = async (event) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n    setSelectedFile(file);\n    setError(\"\");\n    setSummary(\"\");\n    setFixedCode(\"\");\n    await processFile(file);\n  };\n\n  const processFile = async (file) => {\n    setLoading(true);\n    try {\n      const data = new FormData();\n      data.append(\"file\", file);\n      const response = await api.post(\"/codefix\", data, {\n        headers: { \"Content-Type\": \"multipart/form-data\" },\n      });\n      setSummary(response.data.summary);\n      setFixedCode(response.data.fixed_code);\n    } catch (err) {\n      console.error(err);\n      setError(err?.response?.data?.detail || \"Unable to process file.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const copyFixed = async () => {\n    if (!fixedCode) return;\n    await navigator.clipboard.writeText(fixedCode);\n  };\n\n  const downloadFixed = () => {\n    if (!fixedCode || !selectedFile) return;\n    const blob = new Blob([fixedCode], { type: \"text/plain\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    const parts = selectedFile.name.split(\".\");\n    const ext = parts.length > 1 ? parts.pop() : \"txt\";\n    a.download = `${parts.join(\".\") || \"codefix-output\"}.fixed.${ext}`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const language = guessLanguage(selectedFile?.name);\n\n  return (\n    <div className=\"page codefix-page\">\n      <div className=\"codefix-pane codefix-left\">\n        <div className=\"codefix-card\">\n          <h2>Code Fix Agent</h2>\n          <p>Upload a file to let the default agent clean it up and summarize the edits.</p>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\".js,.jsx,.ts,.tsx,.py,.rb,.java,.go,.rs,.cpp,.c,.cs,.php,.swift,.kt,.json,.txt\"\n            style={{ display: \"none\" }}\n            onChange={handleFileChange}\n          />\n          <button className=\"upload-btn\" onClick={triggerUpload} disabled={loading}>\n            {selectedFile ? \"Re-upload\" : \"Upload\"}\n          </button>\n          {selectedFile && (\n            <p className=\"file-meta\">\n              <strong>File:</strong> {selectedFile.name}\n            </p>\n          )}\n          {loading && <p className=\"status\">Running agent...</p>}\n          {error && <p className=\"status error\">{error}</p>}\n          {summary && (\n            <div className=\"summary-box\">\n              <h3>Agent Summary</h3>\n              <p>{summary}</p>\n            </div>\n          )}\n          {fixedCode && (\n            <div className=\"codefix-actions\">\n              <button onClick={copyFixed}>Copy Code</button>\n              <button onClick={downloadFixed}>Download</button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"codefix-pane codefix-right\">\n        <div className=\"code-view\">\n          <div className=\"code-view__header\">\n            <span>{selectedFile ? selectedFile.name : \"Awaiting upload...\"}</span>\n          </div>\n          <div className=\"code-view__body\">\n            <SyntaxHighlighter\n              language={language}\n              style={oneDark}\n              showLineNumbers\n              wrapLines\n              customStyle={{ background: \"transparent\", minHeight: \"100%\" }}\n            >\n              {fixedCode || \"// Upload a file to see the fixed output here.\"}\n            </SyntaxHighlighter>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}