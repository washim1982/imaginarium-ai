

services:
  frontend-prod:
    build:
      context: .
      dockerfile: Dockerfile.prod.frontend
      args:
        # These values are taken from the shell environment. To source from
        # your repo's .env.production, run compose with --env-file .env.production
        REACT_APP_AUTH0_DOMAIN: ${REACT_APP_AUTH0_DOMAIN}
        REACT_APP_AUTH0_CLIENT_ID: ${REACT_APP_AUTH0_CLIENT_ID}
        REACT_APP_AUTH0_AUDIENCE: ${REACT_APP_AUTH0_AUDIENCE}
    container_name: frontend-prod
    env_file:
      - .env.production
    networks:
      - imaginarium

  backend-prod:
    build:
      context: .
      dockerfile: Dockerfile.prod.backend
    container_name: backend-prod
    env_file:
      - .env.production
    environment:
      - OLLAMA_HOST=http://ollama-prod:11434
    expose:
      - "8000"
    networks:
      - imaginarium

  nginx-prod:
    image: nginx:1.27
    container_name: nginx-prod
    volumes:
      - ./nginx.prod.conf:/etc/nginx/conf.d/default.conf:ro
      - /etc/letsencrypt:/etc/letsencrypt:ro
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - frontend-prod
      - backend-prod
    networks:
      - imaginarium

  ollama-prod:
    image: ollama/ollama:latest
    container_name: ollama-prod
    volumes:
      - ollama-data:/root/.ollama
    expose:
      - "11434"
    networks:
      - imaginarium

networks:
  imaginarium:
    driver: bridge

volumes:
  ollama-data:
